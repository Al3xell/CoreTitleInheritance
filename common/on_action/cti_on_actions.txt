#Adding calls to my code to pre-existing on_actions for titles.

on_title_destroyed = {
    on_actions = {
        cti_on_title_destroyed
    }
}

on_game_start_after_lobby = {
    on_actions = {
        cti_on_game_start_after_lobby
    }
}

#on_title_gain = {
#    on_actions = {
#        cti_on_title_gain
#    }
#}

on_title_loss = {
    on_actions = {
        cti_on_title_loss
    }
}

# My on_actions which call the rest of my code.

cti_on_title_destroyed = {
    effect = {
        #scope:landed_title = {safe_de_core_title}
        #recalculate_cores
    }
}

#cti_on_title_gain = {
#    on_actions = {
#        cti_on_title_gain
#    }
#}

cti_on_title_loss = { # assumes that the title has already changed hands. might complain if the title is being created.
    effect = {
        if = {
            limit = {
                AND = {
                    scope:transfer_type = flag:inheritance
                    has_game_rule = true_core_persist
                }
            }
            #recalculate_cores
            #scope:new_holder = recalculate_cores
        }
        else = {
            #scope:title = safe_de_core_title
            #recalculate_cores
            #scope:new_holder = recalculate_cores
        }
    }
}

cti_on_game_start_after_lobby = {
    effect = {
        if = {
            limit = {
                OR = {
                    has_game_rule = overtime_core_holding_cost
                    has_game_rule = control_core_holding_benefit
                }
            }
            #every_ruler = {recalculate_cores}# Will ignore baron tier
        }
    }
}