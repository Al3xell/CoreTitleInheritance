# All scopes are titles unless otherwise noted.

is_title_core_due_to_capital = { # scope is title
    OR = {
        holder.capital_barony = root # capital barony
        AND = {
            holder.capital_barony = {any_this_title_or_de_jure_above = {this = root}}# de_jure above capital barony # I think this trigger is meant for characters.
            tier < holder.primary_title.tier # not the same tier as the primary title
        }
    }
}

is_title_core_due_to_cti = {
    exists = var:core
    NOT = {
        AND = {
            is_title_core_due_to_capital = yes
            holder.primary_title = root
        }
    }
}
# MUST BE CAREFUL THAT THE TRIGGERS ABOVE AND BELOW THIS AGREE!
#This catches primary titles and capitals as well (I assume)
is_title_core = { # Assume that this will only be called if the title is owned
    trigger_if = {
        limit = {exists = var:core}
        OR = {
            var:core = yes# var:core should be a boolean
            is_title_core_due_to_capital = yes
            holder.primary_title = root
        }
    }
    trigger_else = {
        OR = {
            is_title_core_due_to_capital = yes
            holder.primary_title = root
        }
    }
}

is_title_holding = { # scope is title
    tier <= tier_county
}

is_title_eligible_for_core = { # Assume that this will only be called if the title is owned
    is_title_core = no # not a core title
    OR = {
        is_title_holding = yes # county or lower
        holder = {# Changes scope to holder
            any_core_title = { # direct de jure liege of another core title
            this.de_jure_liege = root
            }
        }
    }
}

# assumes that core title rules are being followed - only checks one tier up
# ignores capital chain because it should always be intact, and one cannot de-core a title in it.
will_core_loss_break_titles = { # scope is title
    AND = {
        root.de_jure_liege = {is_title_core = yes} # parent title is core
        root.de_jure_liege.holder = holder # parent title is held by the same character
        NOT = {holder.primary_title = root.de_jure_liege} # parent title is not the holder's primary title
        NOT = {# parent title is not de jure liege of any sibling core titles
            holder = {
                any_core_title = { 
                    AND = {
                        NOT = {this = root}
                        this.de_jure_liege = root.de_jure_liege
                    }
                }
            }
        }
    }
}


is_core_consistent = {# scope is title
    OR = {
        is_title_holding = yes
        holder.primary_title = root
        is_title_core_due_to_capital = yes
        holder = {
            any_core_title = {
                this.de_jure_liege = root
            }
        }
    }
}

is_over_core_limit = { # scope is character
    trigger_if = {
        limit = {exists = var:core_count}
        var:core_count > core_limit
    }
    trigger_else = {
        always = no
    }
}

# Different from the trigger contained within in case one wants to add a character restriction on coring titles. There used to be one that characters were not allowed to go over their core limit.
can_core_title = {
    is_title_eligible_for_core = yes
}

can_de_core_title = {
    AND = {
        is_title_core_due_to_cti = yes
        will_core_loss_break_titles = no
    }
}